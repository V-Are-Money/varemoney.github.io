<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scrolling Collision Effect</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    function App() {
        const [scrollY, setScrollY] = React.useState(0);
        const [imageHeight, setImageHeight] = React.useState(200);
        const [viewportHeight, setViewportHeight] = React.useState(window.innerHeight);
        const [tokenomicsHeight, setTokenomicsHeight] = React.useState(200);

        const handleTokenomicsLoad = (e) => {
            setTokenomicsHeight(e.target.height);
        };

        const gap = 800;
        const topGap = viewportHeight / 4;
        const fadeOutDistance = 300;
        const fadeInDistance = 200;
        const boxHeight = 200;

        const handleImageLoad = (e) => {
            setImageHeight(e.target.height);
        };

        const collisionPoint1 = topGap + imageHeight + gap;
        const collisionPoint2 = collisionPoint1 + tokenomicsHeight + gap;

        React.useEffect(() => {
            const handleScroll = () => {
                setScrollY(window.scrollY);
                if (window.scrollY >= collisionPoint1 - topGap - imageHeight) {
                    console.log('Collision 1 started!');
                }
                if (window.scrollY >= collisionPoint2 - topGap - boxHeight) {
                    console.log('Collision 2 started!');
                }
            };

            window.addEventListener('scroll', handleScroll);
            return () => {
                window.removeEventListener('scroll', handleScroll);
            };
        }, [collisionPoint1, collisionPoint2, topGap, imageHeight]);

        const isColliding1 = scrollY >= collisionPoint1 - topGap - imageHeight;
        const isColliding2 = scrollY >= collisionPoint2 - topGap - boxHeight;

        const collisionProgress1 = Math.max(
            0,
            Math.min(
                1,
                (scrollY - (collisionPoint1 - topGap - imageHeight)) / imageHeight
            )
        );
        const collisionProgress2 = Math.max(
            0,
            Math.min(
                1,
                (scrollY - (collisionPoint2 - topGap - boxHeight)) / boxHeight
            )
        );

        const box1Position =
            scrollY < collisionPoint1 - topGap - imageHeight
                ? Math.max(topGap, topGap - scrollY)
                : collisionProgress1 < 1
                    ? topGap - imageHeight * collisionProgress1
                    : topGap - imageHeight - (scrollY - (collisionPoint1 - topGap));

        const box2Position =
            scrollY < collisionPoint2 - topGap - boxHeight
                ? Math.max(
                    topGap,
                    Math.min(collisionPoint1 - scrollY, topGap + boxHeight + gap)
                )
                : collisionProgress2 < 1
                    ? topGap - boxHeight * collisionProgress2
                    : topGap - boxHeight - (scrollY - (collisionPoint2 - topGap));

        const box3Position = Math.max(
            topGap,
            Math.min(collisionPoint2 - scrollY, topGap + boxHeight + gap * 2)
        );

        const box1Opacity = isColliding1
            ? Math.max(0, 1 - (scrollY - (collisionPoint1 - topGap)) / fadeOutDistance)
            : 1;

        const fadeInStartPoint1 = collisionPoint1 - topGap - boxHeight - fadeInDistance - 100;
        const fadeInStartPoint2 = collisionPoint2 - topGap - boxHeight - fadeInDistance - 100;

        const box2Opacity = isColliding2
            ? Math.max(0, 1 - (scrollY - (collisionPoint2 - topGap)) / fadeOutDistance)
            : Math.min(1, (scrollY - fadeInStartPoint1) / fadeInDistance);

        const box3Opacity = Math.min(
            1,
            (scrollY - fadeInStartPoint2) / fadeInDistance
        );

        return (
            <div className="h-[600vh] relative">
                <div
                    className="fixed top-0 left-1/2 w-3/4 flex flex-col items-center justify-center transform -translate-x-1/2"
                    style={{
                        transform: `translateX(-50%) translateY(${box1Position}px)`,
                        transition: 'transform 0.1s ease-out, opacity 0.3s ease-out',
                        opacity: box1Opacity,
                    }}
                >
                    <div className="flex flex-col items-center">
                        <img
                            src="images/content/welcome.png"
                            alt="Welcome"
                            className="w-full h-auto"
                            onLoad={handleImageLoad}
                        />
                        <div
                            className="text-center text-xl mt-5"
                            style={{
                                opacity: isColliding1 ? 0 : 1,
                                transition: 'opacity 0.3s ease-out',
                            }}
                        >
                            Additional text below Box 1
                        </div>
                    </div>
                </div>
                <div
                    className="fixed top-0 left-1/2 w-3/4 flex flex-col items-center justify-center transform -translate-x-1/2"
                    style={{
                        transform: `translateX(-50%) translateY(${box2Position}px)`,
                        transition: 'transform 0.1s ease-out, opacity 0.3s ease-out',
                        opacity: box2Opacity,
                    }}
                >
                    <div className="flex flex-col items-center">
                        <img
                            src="images/content/tokenomics-with-text.png"
                            alt="Tokenomics"
                            className="w-full h-auto"
                            onLoad={handleTokenomicsLoad}
                        />
                        <div
                            className="text-center text-xl mt-5"
                            style={{
                                opacity: isColliding2 ? 0 : 1,
                                transition: 'opacity 0.3s ease-out',
                            }}
                        >
                            Additional text below Box 2
                        </div>
                    </div>
                </div>
                <div
                    className="fixed top-0 left-1/2 w-3/4 h-[200px] bg-green-500 flex items-center justify-center text-white text-2xl transform -translate-x-1/2"
                    style={{
                        transform: `translateX(-50%) translateY(${box3Position}px)`,
                        transition: 'transform 0.1s ease-out, opacity 0.3s ease-out',
                        opacity: box3Opacity,
                    }}
                >
                    Box 3.0
                    <br />
                    Box 3.1
                    <br />
                    Box 3.2
                    <br />
                    Box 3.3
                    <br />
                    Box 3.4
                    <br />
                    Box 3.5
                </div>
            </div>
        );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
